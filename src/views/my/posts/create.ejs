<%- contentFor('styles') %> <%- contentFor('scripts') %>
<script>
  const generateForm = () => {
    return `
      <div class="row mx-auto" style="max-width: 500px;">
        <form id="post-new-form">
          <div class="my-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" name="title" class="form-control" id="titleInput">
          </div>
          <div class="my-3">
            <label for="contentInput" class="form-label">Content</label>
            <textarea class="form-control" name="content" id="contentInput" rows="10"></textarea>
          </div>
          <div class="form-check form-switch my-3">
            <input class="form-check-input" type="checkbox" id="private-check" name="private-check">
            <label class="form-check-label" for="private-check">Make the post private</label>
          </div>
          <button class="btn btn-primary mx-auto my-4" id="add-new-post">Post</button>
        </form>
      </div>
    `;
  };

  const generatePage = () => {
    const $page = $("#pages-my-posts-new");
    const $title = $("#page-title");
    const $form = generateForm();

    $page.html("").append($title).append($form);
  };

  $(document).ready(() => {
    generatePage();

    $('#private-check').on('click', (e) => {
      console.log(e.target.value)
      if ($('#private-check').is('checked')) {
        $('#private-check').value('FALSE')
      }
    })

    $("#pages-my-posts-new").on("submit", "#post-new-form", (e) => {
      e.preventDefault()

      const data = new FormData(e.target);
      console.log(data)
      $('#post-new-form button[type="submit"]').attr("disabled", true);

      axios({
      method: "POST",
      url: "/api/my/posts",
      data,
    })
      .then((resp) => {
        window.location.href = `/my/posts`;
      })
      .catch((err) => {
        generatePage();
      });
    });


  });
</script>

<%- contentFor('body') %>
<div id="page-title" class="text-center py-3"><h1>Create My New Post</h1></div>
<div id="pages-my-posts-new" class="container"></div>
