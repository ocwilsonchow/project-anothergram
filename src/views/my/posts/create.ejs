<%- contentFor('styles') %> <%- contentFor('scripts') %>
<script>
  const generateForm = () => {
    return `
      <div class="my-2 row mx-auto p-3 bg-white" style="border-radius: 1rem">
        <form id="post-new-form">
          <h1 class="text-center py-3">Create My New Post</h1>
          <div class="my-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" name="title" class="form-control" id="titleInput" required>
          </div>
          <div class="my-3">
            <label for="contentInput" class="form-label">Content</label>
            <textarea class="form-control" name="content" id="contentInput" rows="10" required></textarea>
          </div>

          <!-- Add image -->
          <div class="my-3">
            <label for="imageURL" class="form-label">Image</label>
            <input id="imageURL" class="form-control" name="imageURL" type="file"></input>
          </div>

           <!-- Add Public -->
          <div class="form-check form-switch my-3">
            <input class="form-check-input" type="checkbox" id="public" name="public">
            <label class="form-check-label" for="public">Make this post public</label>
          </div>
          <button class="btn btn-primary mx-auto my-4" id="add-new-post">Post</button>
        </form>
      </div>
    `;
  };

  const generatePage = () => {
    const $page = $("#pages-my-posts-new");

    const $form = generateForm();

    $page.html("").append($form);
  };

  $(document).ready(() => {
    generatePage()

    $("#pages-my-posts-new").on("submit", "#post-new-form", (e) => {
      e.preventDefault()

      const data = new FormData(e.target);
      console.log(data)
      $('#post-new-form button[type="submit"]').attr("disabled", true);

      axios({
      method: "POST",
      url: "/api/my/posts",
      data,
    })
      .then((resp) => {
        window.location.href = `/my/posts`;
      })
      .catch((err) => {
        generatePage();
      });
    });


  });
</script>

<%- contentFor('body') %>

<div id="pages-my-posts-new" class=""></div>
