<%- contentFor('styles') %> <%- contentFor('scripts') %>
<script>
  const generateTitle = () => {
    return `
    <h1 class="text-center">All My Posts</h1>`
  }

  const generatePost = () => {
    return `
      <div class="col">
        <a class="card text-body" href="/my/posts/${post.id}" style="text-decoration: none;">
          <div class="card-body text-center">
            <img class="mb-2" src="${post.user.avatar}" alt="user avatar" width="50" />
            <h5 class="card-title mb-2">${post.title}</h5>
            <p class="card-text mb-2">${post.content}</p>
            <p class="card-subtitle text-muted">${moment(post.createdAt).format('YYYY/MM/DD')}</p>
          </div>
        </a>
      </div>
`;
  };

  const generatePosts = ({ isLoading, posts = [] } = {}) => {
      if (isLoading) return `<div class="text-center mb-3">Loading...</div>`
      if (posts.length === 0) {
        return `
          <h2 class="text-center mb-3">No Post Found!</h2>
          <div class="text-center">
            <a class="btn btn-primary" href="/my/post/new">Create New Post</a>
          </div>
        `
      }
      return `
        <div class="row">
          <div class="col-12 col-md-10 offset-md-1 col-lg-8 offset-lg-2">
            <div class="row row-cols-1 g-3">
              ${posts.map((post) => generatePost(post)).join('')}
            </div>
          </div>
        </div>
      `
  }

  const generatePage = () => {
    const $page = $("#pages-my-posts-index");
    const $posts = generatePosts();

    $page.html("").append($posts);
  };

  $(document).ready(() => {
    generatePage({ isLoading: true })

    axios({
      method: 'GET',
      url: '/api/my/posts'
    }).then((resp) => {
      generatePage({posts: resp.data.posts})
    })

  });
</script>

<%- contentFor('body') %>
<div id="pages-my-posts-index" class="container"></div>
